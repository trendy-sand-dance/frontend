<!-- views/partials/sidebar-players.ejs -->

<div 
	id=friend-view
	class="p-4 space-y-6 text-black animate-slide-in"
	hx-trigger="load, refresh from:body">
	<!-- Requests -->
	<section>
		<h2 class="text-xl font-bold mb-2">Friend Requests</h2>
		<% if (requests.length > 0) 
			{ 
			%> <% requests.forEach(function(req) 
				{ %>
				<div class="flex items-center justify-between bg-blue-100 p-2 rounded shadow">
					<div>
						<strong><%= req.username %></strong>
					</div>
					<div 
						class="space-x-2">
						<button
							class="text-green-500 hover:text-green-700"
							hx-post="/acceptReq/<%=userId%>/<%=req.id%>"
							hx-on="htmx:afterRequest: htmx.trigger('#friend-view', 'refresh')">
							Accept
						</button>
						<button 
							class="text-red-500 hover:text-red-700"
							hx-delete="/rejectReq/<%=userId%>/<%=req.id%>"
							hx-on="htmx:afterRequest: htmx.trigger('#friend-view', 'refresh')">
							Decline
						</button>
					</div>
				</div>
				<% }); %>
				<% } else { %> <p class="text-gray-500 italic">No incoming friend requests.</p> <% } %>
			</section>
			
			<!-- Friends -->
			<section>
				<h2 class="text-xl font-bold mb-2">Friends</h2>
				<% if (friends.length > 0) { %>
		<% friends.forEach(function(friend) { %>
			<div class="flex items-center justify-between bg-green-100 p-2 rounded shadow">
				<div>
					<strong><%= friend.username %></strong> 
			  <div class="text-sm text-gray-600">Wins: <%= friend.wins %> | Losses: <%= friend.losses %></div>
			</div>
			<button
			class="text-red-500 hover:text-red-700"
			hx-delete="/deleteFriend/<%=friend.id%>/<%=userId%>"
			hx-on="htmx:afterRequest: htmx.trigger('#friend-view', 'refresh')">
			Unfriend
		</button>
		<button 
			class="bg-red-500 hover:bg-red-1000"
			hx-post="/block/<%=friend.id%>/<%=userId%>">
			Block
		</button>
		  </div>
		<% }); %>
	  <% } else { %>
		<p class="text-gray-500 italic">No friends yet.</p>
	  <% } %>
	</section>
  
	<!-- Pending -->
	<section>
	  <h2 class="text-xl font-bold mb-2">Pending Requests</h2>
	  <% if (pending.length > 0) { %>
		<% pending.forEach(function(pend) { %>
		  <div class="flex items-center justify-between bg-yellow-100 p-2 rounded shadow">
			<div><strong><%= pend.username %></strong></div>
			<button 
					class="text-green-500 hover:text-green-700"
					hx-delete="/rejectReq/<%=pend.id%>/<%=userId%>"
					hx-swap="none"
					hx-on="htmx:afterRequest: htmx.trigger('#friend-view', 'refresh')">
					Cancel Request
			</button>
		  </div>
		<% }); %>
	  <% } else { %>
		<p class="text-gray-500 italic">No pending requests.</p>
	  <% } %>
	</section>
  
	<!-- Blocked -->
	<section>
	  <h2 class="text-xl font-bold mb-2">Blocked Users</h2>
	  <% if (blocked.length > 0) { %>
		<% blocked.forEach(function(block) { %>
		  <div class="flex items-center justify-between bg-red-100 p-2 rounded shadow">
			<div><strong><%= block.username %></strong></div>
			<button
				class="text-blue-500 hover:text-blue-700"
				hx-delete="/deleteFriend/<%=block.id%>/<%=userId%>">
				Unblock
			</button>
		  </div>
		<% }); %>
	  <% } else { %>
		<p class="text-gray-500 italic">No blocked users.</p>
	  <% } %>
	</section>
  
  
  </div>
  
  <script>
	document.getElementById('sidebar')?.classList.toggle('hidden');
  </script>